@startuml Trustee_System_Sequence_Diagram
' Visit http://www.plantuml.com/plantuml/uml/ and paste this content to generate the diagram
' Or download PlantUML jar file and use command: java -jar plantuml.jar sequence_diagram_en.puml

skinparam backgroundColor white
skinparam handwritten false
skinparam sequenceArrowThickness 2
skinparam sequenceParticipant underline

!define USER_COLOR #E2F0D9
!define VISUAL_COLOR #FFE699
!define TASK_COLOR #BDD7EE
!define OPERATION_COLOR #F8CBAD
!define SECURITY_COLOR #D9D9D9

actor 'User' as User #USER_COLOR

box "Trustee System" #F5F5F5
participant "User Interface Layer" as UI #USER_COLOR
participant "Visual Perception Layer" as Visual #VISUAL_COLOR
participant "Task Understanding Layer" as Task #TASK_COLOR
participant "Operation Execution Layer" as Operation #OPERATION_COLOR
participant "Security Control Layer" as Security #SECURITY_COLOR
participant "Windows System" as Windows
end box

== Initialization Phase ==
User -> UI: "Launch System"
activate UI
UI -> Security: "Verify User Permissions"
activate Security
Security --> UI: "Permission Verified"
deactivate Security
UI -> Visual: "Initialize Visual Model"
activate Visual
Visual --> UI: "Visual Model Ready"
deactivate Visual
UI -> Task: "Initialize Task Reasoning System"
activate Task
Task --> UI: "Task Reasoning System Ready"
deactivate Task
UI -> Operation: "Initialize Operation Module"
activate Operation
Operation --> UI: "Operation Module Ready"
deactivate Operation
UI --> User: "System Ready"
deactivate UI

== Task Execution Phase ==
User -> UI: "Input Natural Language Instruction"
activate UI
UI -> Task: "Parse User Instruction"
activate Task
Task -> Task: "Task Decomposition & Planning"
Task --> UI: "Return Task Execution Plan"
deactivate Task

UI -> Security: "Check Operation Permissions"
activate Security
Security --> UI: "Permission Verified"
deactivate Security

UI -> Visual: "Capture Current Screen State"
activate Visual
Visual -> Visual: "Identify UI Elements and Text"
Visual --> UI: "Return Screen Analysis Result"
deactivate Visual

UI -> Task: "Refine Task with Screen State"
activate Task
Task -> Task: "Generate Specific Operation Sequence"
Task --> UI: "Return Operation Sequence"
deactivate Task

UI -> Operation: "Execute Operation Sequence"
activate Operation
Operation -> Windows: "Call Win32 API"
activate Windows
Windows --> Operation: "API Execution Result"
deactivate Windows
Operation -> Operation: "Verify Operation Result"
Operation --> UI: "Operation Execution Status"
deactivate Operation

UI -> Visual: "Capture Screen State After Execution"
activate Visual
Visual -> Visual: "Analyze Execution Result"
Visual --> UI: "Return Execution Result Analysis"
deactivate Visual

UI -> Task: "Evaluate Task Completion"
activate Task
Task -> Task: "Determine if Strategy Adjustment Needed"
alt "Task Not Completed"
    Task -> Task: "Adjust Execution Strategy"
    Task --> UI: "Return Adjusted Operation Sequence"
    UI -> Operation: "Continue with Adjusted Operations"
else "Task Completed"
    Task --> UI: "Task Completion Confirmation"
end
deactivate Task

UI -> Security: "Record Operation Log"
activate Security
Security -> Security: "Store Audit Information"
Security --> UI: "Log Recording Complete"
deactivate Security

UI --> User: "Display Task Execution Result"
deactivate UI

== Exception Handling Phase ==
alt "Exception Occurs During Execution"
    Operation -> UI: "Report Exception"
    activate UI
    UI -> Task: "Request Exception Handling Strategy"
    activate Task
    Task -> Task: "Generate Exception Handling Plan"
    Task --> UI: "Return Handling Plan"
    deactivate Task
    
    UI -> Security: "Check Exception Handling Permission"
    activate Security
    Security --> UI: "Permission Verified"
    deactivate Security
    
    UI -> Operation: "Execute Exception Handling Operation"
    activate Operation
    Operation -> Windows: "Call Recovery Operation API"
    Operation --> UI: "Exception Handling Result"
    deactivate Operation
    
    UI --> User: "Notify User of Exception and Handling Result"
    deactivate UI
end

== Learning & Optimization Phase ==
User -> UI: "Provide Task Execution Feedback"
activate UI
UI -> Task: "Update Task Knowledge Base"
activate Task
Task -> Task: "Optimize Task Execution Strategy"
Task --> UI: "Knowledge Base Update Complete"
deactivate Task
UI --> User: "Confirm Optimization Complete"
deactivate UI

@enduml 